const path = require('node:path');

const rspack = require('@rspack-template/core');

const compiler = rspack({
  context: __dirname,
  mode: 'development',
  entry: {
    main: './src/index.js',
  },
  devtool: false,
  module: {
    rules: [
      {
        test: /\.js$/,
        use: [
          {
            // Use the custom banner loader that prepends a banner to source files
            loader: 'builtin:my-banner-loader',
            options: '/** Generated by builtin:my-banner-loader in `@rspack-template/binding` */',
          },
        ],
      },
    ],
  },
  output: {
    path: path.resolve(__dirname, 'dist'),
  },
  plugins: [
    // Register the MyBannerLoaderPlugin to enable the `builtin:my-banner-loader` loader
    new rspack.MyBannerLoaderPlugin(),
  ],
});

compiler.run((err, stats) => {
  if (err) {
    console.error(err);
  }
  console.info(stats.toString({ colors: true }));
});
